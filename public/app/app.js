var RECIPES = [
  {
     "recipeTitle":"Supreme Pizza",
     "recipeThumbImg":"pizzathumb_300x263.jpg",
     "recipeFullImg":"recipe-pizza.jpg",
     "recipeBriefDescription":"Make pizza night super duper out of this world with homemade pizza. This recipe is supreme with vegetables and two types of meat. Yum!",
     "recipeDescription":"Make pizza night super duper out of this world with homemade pizza. This recipe is supreme with vegetables and two types of meat. Yum!",
     "recipeTime":"1h 24min",
     "recipeServings":"4 servings",
     "recipeIngredients":[
        {
           "ingredient":"1/4 batch pizza dough"
        },
        {
           "ingredient":"2 tablespoons Last-Minute Pizza Sauce"
        },
        {
           "ingredient":"10 slices pepperoni"
        },
        {
           "ingredient":"1 cup cooked and crumbled Italian sausage"
        },
        {
           "ingredient":"2 large mushrooms"
        },
        {
           "ingredient":"sliced 1/4 bell pepper sliced"
        },
        {
           "ingredient":"1 tablespoon sliced black olives"
        },
        {
           "ingredient":"1 cup shredded mozzarella cheese"
        }
     ],
     "recipeInstructions":[
        {
           "instruction":"1. Preheat the oven to 475째. Spray pizza pan with nonstick cooking or line a baking sheet with parchment paper. "
        },
        {
           "instruction":"2. Flatten dough into a thin round and place on the pizza pan. "
        },
        {
           "instruction":"3. Spread pizza sauce over the dough."
        },
        {
           "instruction":" 4. Layer the toppings over the dough in the order listed."
        },
        {
           "instruction":" 5. Bake for 8 to 10 minutes or until the crust is crisp and the cheese melted and lightly browned."
        }
     ]
  },
  {
     "recipeTitle":"Classic Burger",
     "recipeThumbImg":"burgerthumb_300x263.jpg",
     "recipeFullImg":"recipe-burger.jpg",
     "recipeBriefDescription":"Sink your teeth into a delicious restaurant-style, hamburger recipe made from lean beef. Skip the prepackaged patties and take the extra time to craft up your own, and that little extra effort will be worth it.",
     "recipeDescription":"Sink your teeth into a delicious restaurant-style, hamburger recipe made from lean beef. Skip the prepackaged patties and take the extra time to craft up your own, and that little extra effort will be worth it.Make pizza night super duper out of this world with homemade pizza. This recipe is supreme with vegetables and two types of meat. Yum!",
     "recipeTime":"30 min",
     "recipeServings":"4 servings",
     "recipeIngredients":[
        {
           "ingredient":"1/4 batch pizza dough"
        },
        {
           "ingredient":"2 tablespoons Last-Minute Pizza Sauce"
        },
        {
           "ingredient":"10 slices pepperoni"
        },
        {
           "ingredient":"1 cup cooked and crumbled Italian sausage"
        },
        {
           "ingredient":"2 large mushrooms"
        },
        {
           "ingredient":"sliced 1/4 bell pepper sliced"
        },
        {
           "ingredient":"1 tablespoon sliced black olives"
        },
        {
           "ingredient":"1 cup shredded mozzarella cheese"
        }
     ],
     "recipeInstructions":[
        {
           "instruction":"1. Preheat the oven to 475째. Spray pizza pan with nonstick cooking or line a baking sheet with parchment paper. "
        },
        {
           "instruction":"2. Flatten dough into a thin round and place on the pizza pan. "
        },
        {
           "instruction":"3. Spread pizza sauce over the dough."
        },
        {
           "instruction":" 4. Layer the toppings over the dough in the order listed."
        },
        {
           "instruction":" 5. Bake for 8 to 10 minutes or until the crust is crisp and the cheese melted and lightly browned."
        }
     ]
  },
  {
     "recipeTitle":"Chicken Biryani",
     "recipeThumbImg":"biryanithumb_300x263.jpg",
     "recipeFullImg":"recipe-pilaf.jpg",
     "recipeBriefDescription":"Chicken Biryani is a bold and flavorful Indian dish with crazy tender bites of chicken with bell peppers in a deliciously spiced and fragrant rice.",
     "recipeDescription":"Chicken Biryani is a bold and flavorful Indian dish with crazy tender bites of chicken with bell peppers in a deliciously spiced and fragrant rice.",
     "recipeTime":"1h 15min",
     "recipeServings":"6 servings",
     "recipeIngredients":[
        {
           "ingredient":"1/4 batch pizza dough"
        },
        {
           "ingredient":"2 tablespoons Last-Minute Pizza Sauce"
        },
        {
           "ingredient":"10 slices pepperoni"
        },
        {
           "ingredient":"1 cup cooked and crumbled Italian sausage"
        },
        {
           "ingredient":"2 large mushrooms"
        },
        {
           "ingredient":"sliced 1/4 bell pepper sliced"
        },
        {
           "ingredient":"1 tablespoon sliced black olives"
        },
        {
           "ingredient":"1 cup shredded mozzarella cheese"
        }
     ],
     "recipeInstructions":[
        {
           "instruction":"1. Preheat the oven to 475째. Spray pizza pan with nonstick cooking or line a baking sheet with parchment paper. "
        },
        {
           "instruction":"2. Flatten dough into a thin round and place on the pizza pan. "
        },
        {
           "instruction":"3. Spread pizza sauce over the dough."
        },
        {
           "instruction":" 4. Layer the toppings over the dough in the order listed."
        },
        {
           "instruction":" 5. Bake for 8 to 10 minutes or until the crust is crisp and the cheese melted and lightly browned."
        }
     ]
  },
  {
     "recipeTitle":"Ch. Chow Mein",
     "recipeThumbImg":"chowmeinthumb_300x263.jpg",
     "recipeFullImg":"recipe-chowmein.jpg",
     "recipeBriefDescription":"A great Chow Mein comes down to the sauce - it takes more than just soy sauce and sugar! Jam packed with a surprising amount of hidden vegetables, customize this Chicken Chow Mein recipe using your protein of choice!",
     "recipeDescription":"A great Chow Mein comes down to the sauce - it takes more than just soy sauce and sugar! Jam packed with a surprising amount of hidden vegetables, customize this Chicken Chow Mein recipe using your protein of choice!",
     "recipeTime":"20 min",
     "recipeServings":"4 servings",
     "recipeIngredients":[
        {
           "ingredient":"1/4 batch pizza dough"
        },
        {
           "ingredient":"2 tablespoons Last-Minute Pizza Sauce"
        },
        {
           "ingredient":"10 slices pepperoni"
        },
        {
           "ingredient":"1 cup cooked and crumbled Italian sausage"
        },
        {
           "ingredient":"2 large mushrooms"
        },
        {
           "ingredient":"sliced 1/4 bell pepper sliced"
        },
        {
           "ingredient":"1 tablespoon sliced black olives"
        },
        {
           "ingredient":"1 cup shredded mozzarella cheese"
        }
     ],
     "recipeInstructions":[
        {
           "instruction":"1. Preheat the oven to 475째. Spray pizza pan with nonstick cooking or line a baking sheet with parchment paper. "
        },
        {
           "instruction":"2. Flatten dough into a thin round and place on the pizza pan. "
        },
        {
           "instruction":"3. Spread pizza sauce over the dough."
        },
        {
           "instruction":" 4. Layer the toppings over the dough in the order listed."
        },
        {
           "instruction":" 5. Bake for 8 to 10 minutes or until the crust is crisp and the cheese melted and lightly browned."
        }
     ]
  }
];

var RECIPEINGREDIETNS = [];

var _db = "";
var userExists = false;
var userFullName = "";
var _userProfileInfo = {};



function changeRoute() {
    let hashTag = window.location.hash;
    let pageID = hashTag.replace("#","");

MODEL.updateView(pageID)
}

function initURLListener(){
    $(window).on("hashchange", changeRoute);
    changeRoute();
}

function initListeners() {
    $(".bars").click(function (e) {
        $(".bars").toggleClass("active");
        $(".links").toggleClass("active");
    });

$(".links a").click(function (e) {
    $(".bars").toggleClass("active");
    $(".links").toggleClass("active");

});
}

// });


function loadData(){
$.each(_userProfileInfo.recipes, function(index, recipe){
$("#app .recipe-boxes").append(`

        <!-- ===RECIPES===== -->
   
        <div id="${index}"" class="your-box">
        <div class="your-image">
        <img src="images/pizzaThumbs-assets/${recipe.recipeThumbImg}"
            <a href="#fullrecipe">
            <button class="view">View</button>
         </a>
         </div>
        
        <div class="your-description">
            <div class="your-title">${recipe.recipeTitle}</div>
            <div class="your-text">${recipe.recipeBriefDescription}</div>
            <div class="recipe-stats">
            <div class="icon timer"></div>
            <div class="time">${recipe.recipeTime}</div>
         </div>
         <div class="recipe-stats">
             <div class="icon meal"></div>
             <div class="servings">${recipe.recipeServings}
             </div>
          </div>
        </div>
       
        <div class="edit-delete-container">
            <a href="#editrecipe">
        <button class="edit">Edit Recipe</button>
     </a>
        <button class="delete">Delete</button>
     </div>
</div>`);
});
initRecipeListeners();
}

function loadIngredients(){
   let ingredientString = "<ul>"
   $.each(RECIPES.RECIPEINGREDIETNS, function(index){
ingredientString += `<li id=${index}">${RECIPES.ingredient}</li>`
   });
   ingredientString += "</ul>";
   $("#app .ingredient").html(ingredientString);
}



function initRecipeListeners() {
   $(".your-box").click(function(e) {
      let recipeIndex = e.currentTarget.id;
   // });
        
      $("#app .your-content").html(`
      <div class="fullrecipe-content">
    <div class="fullrecipe-container" >
        <div class="image-descript">
            
<div class="fullrecipe-image" id="fullrecipe-image">
<img src="images/${RECIPES[recipeIndex].recipeFullImg}"
</div>
<div class="fullrecipe-description">
    <div class="descript">Description:</div>
    <div class="fullrecipe-text">
    ${RECIPES[recipeIndex].recipeBriefDescription}
    </div>
    <div class="total-time">Total Time:</div>
    <div class="time"> ${RECIPES[recipeIndex].recipeTime}</div>
    <div class="serve">Servings:</div>
    <div class="servings">${RECIPES[recipeIndex].recipeTime}</div>
</div>
        </div>

        <div class="ingredient-container" id="ingredient-container>
        <div class="title-button-holder">
            <div class="ingred-title">Ingredients:</div>
            <button class="load-ingred" onclick="loadIngredients()">Load Ingredients</button> 
            </div>
            <div class="ingredient" id="ingredient">${RECIPEINGREDIENTS[index]}</div>
        </div>

        <div class="instructions-container">
            <div class="instruct-title">Instructions:</div>
            <div class="instruction" id="instruction">${RECIPE.recipeInstructions}
            <div>  
        </div>
        <button class="edit">Edit Recipe</button>
        <button class="close">CLOSE</button>
    <div class="side-text"></div>
    </div>
</div>`);
      addCLoseListener();
});

}
// $(".your").click(function(e) {
//    $("#your").css(".your-content");
// });



function addCloseListener(){
   $(".close").click(function(){
      $("#app .fullrecipe-content").html("");
      loadData();
   });
}



// ====OBJECTS====//


function addMainRecipe() {
let newRecipeTitle = $("#recipeName").val();
let newRecipeThumbImg = $("#attach").val();
let newRecipeFullImg = $("#fullrecipe-image").val();
let newRecipeBriefDescription = $("#full-description").val();
let newRecipeDescription = $("#fulldescription").val();
let newRecipeTime = $("#recipe-time").val();
let newRecipeServings = $("#recipe-serve").val();
let newRecipeIngredients = $("#ingredient").val();
let newRecipeInstructions = $("#instruction").val();

  let newRecipeObj = {
      recipeTitle: newRecipeTitle,
      recipeThumbImg: newRecipeThumbImg, 
      recipeFullImg: newRecipeFullImg,
      recipeBriefDescription: newRecipeBriefDescription,
      recipeDescription: newRecipeDescription,
      recipeTime: newRecipeTime,
      recipeServings: newRecipeServings,
      recipeIngredients: [],
      recipeInstructions: [],
  };
_userProfileInfo.recipes.push(newRecipeObj);
updateUserInfo(_userProfileInfo);

// ====NEED TO CHANGE TO WHAT MINE IS NAMED
loadData();
$("#recipeName").val("");
  }

  function updateUserInfo(userObj) {
    let id = firebase.auth().currentUser.uid;
    _db
    .collection("Users")
    .doc(id)
    .update(userObj)
    .then(() => {
      console.log("updated doc");
    })
    .catch((error) => {
      var errorCode = error.code;
      var errorMessage = error.message;
      console.log("update error " + errorMessage);
    });
  }

// =====STATE CHANGE====//
function initFirebase() {
    firebase.auth().onAuthStateChanged((user) => {
        if(user){
          _db = firebase.firestore();
console.log("auth change logged in");
// $(".loginbtn").css("display", "none");
// $(".logoutbtn").css("display");

if(user.displayName){
    $(".name").html(user.displayName);
    $("span, .name").html(user.displayName);
    $(".loginbtn").css("display", "none");
    $(".logoutbtn").css("display");
}  

$(".view").prop("disabled", false);

// $(".logoutbtn").prop("display", true);
userExists = true;

$(".accountLogin").click(function(){
  $(".loginbtn").hide();
  $(".logoutbtn").show();
  $(".createbtn").css("display");
$(".your").css("display");
// $("h1, span, .name").css("display");
});

$(".createbtn").click(function(){
  $(".name").show();
})


$(".loginbtn").css("display", "none");
$(".logoutbtn").css("display");




            $(".logoutbtn").click(function(){
              $(this).hide();
              $(".loginbtn").show();
            });

            $(".accountLogin").click(function(){
              $(".loginbtn").hide();
              $(".logoutbtn").show();
            });
          

        } else {
          _db = "";
          _userProfileInfo = {};
            console.log("auth changed logged out");
            $(".name").html("");
            $(".view").prop("disabled", true);

            $(".loginbtn").css("display");
$(".logoutbtn").css("display", "none", true);
            userExists = false;
            userFullName = "";

          
            $(".createbtn").css("display", "none");
            $(".your").css("display", "none");

        }
    });
}

function signOut() { 
    firebase
    .auth()
    .signOut()
    .then(() => {
      console.log("logged out");
    })
    .catch((error) => {
      console.log("Error signing out");
    });
    $(".loginbtn").css("display");
$(".logoutbtn").css("display", "none");


}

// =====LOGIN====//
function login(){
    let loginEmail = $("#loginEmail").val();
    let loginPassword = $("#loginPassword").val();

    firebase.auth().signInWithEmailAndPassword(loginEmail, loginPassword)
  .then((userCredential) => {
    // Signed in
    var user = userCredential.user;
    // ...

    
    console.log("logged in");
    $("#loginEmail").val("");
   $("#loginPassword").val("");

   _db
   .collection("Users")
   .doc(user.uid)
   .get()
   .then((doc) => {
     console.log(doc.data());
     _userProfileInfo = doc.data();
    //  ***change loadlists to what mine is named
    loadData();
     console.log("login userinfo ", _userProfileInfo);

   })

   .catch((error) => {
    var errorCode = error.code;
    var errorMessage = error.message;
    console.log("logged in error " + errorMessage);
  });

$(".loginbtn").hide();
$(".logoutbtn").show();
$(".createbtn").show();
$(".your").show();


  //  $(".loginbtn").css("display", "none");
  //  $(".logoutbtn").css("display");

  })
  .catch((error) => {
    var errorCode = error.code;
    var errorMessage = error.message;
    console.log("logged in error " + errorMessage);
  });
}

// ===CREATE ACCOUNT====//
function createAccount() {
   
    let fName = $("#fName").val();
    let lName = $("#lName").val();
    let createEmail = $("#createEmail").val();
    let createPassword = $("#createPassword").val();
    let fullName = fName + " " + lName;
    let userObj = {
      firstName: fName,
      lastName: lName,
      createEmail: createEmail,
      recipes: [],
    };

    console.log("create " + fName + " " + lName + " " + createEmail + " " + createPassword);

    // ===FBASE AUTH USERNAME/PASSWORD//
    firebase.auth()
    .createUserWithEmailAndPassword(createEmail, createPassword)
  .then((userCredential) => {
    var user = userCredential.user;
    // ...
    console.log('created');
    firebase.auth().currentUser.updateProfile({
        displayName: fullName,
    });

_db.collection("Users")
.doc(user.uid)
.set(userObj)
.then((doc) => {
  console.log("doc added ");
  _userProfileInfo = userObj;
  console.log("create userinfo ", _userProfileInfo);
})

.catch((error) => {
  var errorCode = error.code;
  var errorMessage = error.message;
  console.log('create error ' + errorMessage);
});


    userFullName = fullName;
    $(".name").html(userFullName);
    $("#fName").val("");
    $("#lName").val("");
    $("#createEmail").val("");
    $("#createPassword").val("");

    $(".loginbtn").hide();
    $(".logoutbtn").show();
    $(".createbtn").show();
    $(".your").show();
    $("span, .name").show();
  })

  

  .catch((error) => {
    var errorCode = error.code;
    var errorMessage = error.message;
    console.log('create error ' + errorMessage);
  });
}

function signIn() {
    firebase.auth().signInAnonymously()
  .then(() => {
    console.log("logged in");
    $(".loginbtn").css("display", "none");
   $(".logoutbtn").css("display");
  })

  .catch((error) => {
    var errorCode = error.code;
    var errorMessage = error.message;
    console.log("Error signing in " + errorMessage);
  });
}

// ===DOCUMENT READY===//
$(document).ready(function() {
    try {
        let app = firebase.app();
        initFirebase();
        loadData();
        // signInAnon();
        initListeners();
        initURLListener();
       
    }catch(error){
        console.log("error ", error);
    }
});